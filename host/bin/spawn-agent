#!/bin/bash

source /bin-holo/functions.sh

USERNAME=$1
APPNAME=$2

if [ -z "$1" ] || [ -z "$2" ]
then
  echo "Must supply two args: username and appname"
  exit 1
fi

AGENT_HOME=/agents/$USERNAME

echo "Creating new hosted agent '$USERNAME'..."
useradd -m -d $AGENT_HOME -G agents $USERNAME

cp -r /hosting-happs/accountant $AGENT_HOME/accountant
chown -R $USERNAME $AGENT_HOME/accountant

su -c "/bin-holo/init-chains $APPNAME `freeport 4001 6`" $USERNAME
