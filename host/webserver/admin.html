<!DOCTYPE html>
<html>
<head>
  <title>holo host admin</title>
</head>
<body>
  <h1>holo host admin</h1>

  <h2>registered hApps:</h2>
  <ul id="registered-happs"></ul>

  <h2>hosted agents:</h2>
  <ul id="hosted-happs"></ul>

  <h2>service logs</h2>
  <a href="/admin/logs">view all service logs for all apps</a>

  <script type="text/javascript">
    window.addEventListener('load', () => {
      addRegisteredApps()
      addHostedApps()
    })

    const displayApp = (hash, name) => `<pre>${hash} / ${name}</pre>`

    const addRegisteredApps = () => {
      const ul = document.querySelector('#registered-happs')
      fetch('/api/happs/registered').then(r => r.json()).then(happs => {
        const lis = happs.map(({name, hash}) => `
          <li>${ displayApp(hash, name) }</li>
        `)
        ul.innerHTML = lis.join('')
      })
    }

    const addHostedApps = () => {
      const ul = document.querySelector('#hosted-happs')
      fetch('/api/happs/hosted').then(r => r.json()).then(happs => {
        const lis = happs.map(({appName, dnaHash, agentHash}) => `
            <li>${agentHash}: ${appName}</li>
        `)
        ul.innerHTML = lis.join('')
      })
    }
  </script>
</body>
</html>